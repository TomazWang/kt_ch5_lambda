@file:Suppress("unused", "ConvertCallChainIntoSequence", "MoveLambdaOutsideParentheses", "RedundantLambdaArrow")

package com.tomaz.kt_ch5_lambda

import com.tomaz.kt_ch5_lambda.intro.model.Planet

/**
 * Created by TomazWang on 2019/03/22.
 *
 *
 * @author Tomaz Wang
 * @since 2019/03/22
 **/


//  â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—         â–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
//  â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•         â•šâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
//  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
//  â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘       â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
//  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘            â–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
//  â•šâ•â•  â•šâ•â•   â•šâ•â•            â•šâ•â•      â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•


// Great resources
//
// - KotlinConf 2018 - Dissecting the stdlib by Huyen Tue Dao
// ---- ğŸ”— https://youtu.be/Fzt_9I733Yg
// ---- ğŸ”— https://github.com/queencodemonkey/dissecting-the-stdlib
//
// - KotlinConf 2017 - Two Stones, One Bird: Implementation Tradeoffs by Christina Lee
// ---- ğŸ”— https://youtu.be/YxOTU9F_YX4
//
// - Higher-Order Functions and Lambdas
// ---- ğŸ”— https://kotlinlang.org/docs/reference/lambdas.html

//
//
// ============================================================================================================
//
//


// +-- ğŸ’¡ ä»Šæ—¥ç›®æ¨™ -------------------------------------------------------------------------------
// |
// |    - å­¸æœƒä»€éº¼æ˜¯ Lambda
// |    - æ›´äº†è§£ function ( extension function, higher order function, lambda with receiver)
// |    - å­¸æœƒå…§å»ºçš„å¥½ç”¨ function
// |
// +----------------------------------------------------------------------------------------------


//
// +-- ğŸ’¡ ä½¿ç”¨æ•™å­¸ --------------------------------------------------------------------------------
// |
// |    - çœ‹åˆ° ğŸ“„ -> æœå°‹ä¸¦åˆ‡æ›åˆ°è©²æª”æ¡ˆ ( ğŸ”, ğŸ”‘ ä¸€å°äº’ç›¸é€£çµ )
// |    - çœ‹åˆ° ğŸš€ -> å‰å¾€è©²æª”æ¡ˆï¼Œä¸¦åŸ·è¡Œ main function
// |    - çœ‹åˆ° ğŸ -> åˆ‡æ›ä¸¦è©¦è‘—å®Œæˆé€™å€‹æ¸¬è©¦
// |
// +----------------------------------------------------------------------------------------------


/**
 * æ‰¾åˆ°é©åˆäººé¡å±…ä½çš„æ˜Ÿçƒ
 *
 * å‡è¨­æˆ‘å€‘ä»Šå¤©è¦ç§»æ°‘å®‡å®™ã€æœ‰ä¸€å€‹ function å¯ä»¥å¿«é€Ÿæ‰¾åˆ°é©åˆçš„æ˜Ÿçƒ
 */
fun findEarthReplacements(planets: List<Planet?>): List<Pair<String, Planet>> =
    planets
        .filterNotNull()
        .filter { it.oxygen > 0.18 }
        .filter { it.water > 0.7 }
        .filter { it.temp < 80 && it.temp > -20 }
        .sortedByDescending { it.size }
        .map { it.name to it }

// è©¦è©¦çœ‹
//
// ğŸš€ IntroTest#`test findEarthReplacements`


//
//
// ================================================================================================
//
//

//

//    ____            _        _   _
//   | __ )  __ _ ___(_) ___  | | | |___  __ _  __ _  ___
//   |  _ \ / _` / __| |/ __| | | | / __|/ _` |/ _` |/ _ \
//   | |_) | (_| \__ \ | (__  | |_| \__ \ (_| | (_| |  __/
//   |____/ \__,_|___/_|\___|  \___/|___/\__,_|\__, |\___|
//                                             |___/
//
//    åŸºç¤ function ç”¨æ³•è¤‡ç¿’


// ğŸ“• 5.1.3

//
//
// åŸºæœ¬çš„ function å®£å‘Šæ³•
fun simpleFunction(arg: String) {
    print("Hello $arg")
}

//
//
// æœƒå›å‚³è³‡æ–™çš„ function
fun funcWithReturnValue(x: Int): Int {
    val y = x + 1
    return y
}

//
//
// ç°¡åŒ–ç°¡å–® return
fun funcWithReturnValue2(x: Int) = x + 1

//
//
// ç°¡åŒ–æˆ lambda
val addOne = { x: Int -> x + 1 }

//
//
//
//
val sumOfEven = { ints: IntArray? ->
    
    if (ints == null) {
        0   // lambda ä¸­ä¸èƒ½ä½¿ç”¨ return, å› ç‚º Kotlin ä¸­ return æ˜¯ return æœ€è¿‘ä¸€å€‹ "fun" å®šç¾©
    } else {
        var sum = 0
        for (i in ints) {
            if (i % 2 == 0) {
                sum += i
            }
        }
        sum
    }
}

//
//
//â“é‚£å¦‚æœçœŸçš„å¾ˆæƒ³åŠ  return æ€éº¼è¾¦ => ğŸ BasicCounterTest#`return from lambda`


//
// â›„ å†·çŸ¥è­˜æ™‚é–“
//
// IntArray è½‰æˆ java æœƒè®Šæˆ int[]
// Array<Int> è½‰æˆ java æœƒè®Šæˆ Integer[]


// lambda å¯ä»¥åƒåˆ°å¤–éƒ¨çš„è®Šæ•¸
var counter = 0
val inc = { counter++ }

// ğŸš€ï¸ BasicCounterTest#`lambda can access outer variable`


//
//
// ============================================================================================================
//
//


//    _   _ _       _                  ___          _             _____                 _   _
//   | | | (_) __ _| |__   ___ _ __   / _ \ _ __ __| | ___ _ __  |  ___|   _ _ __   ___| |_(_) ___  _ __
//   | |_| | |/ _` | '_ \ / _ \ '__| | | | | '__/ _` |/ _ \ '__| | |_ | | | | '_ \ / __| __| |/ _ \| '_ \
//   |  _  | | (_| | | | |  __/ |    | |_| | | | (_| |  __/ |    |  _|| |_| | | | | (__| |_| | (_) | | | |
//   |_| |_|_|\__, |_| |_|\___|_|     \___/|_|  \__,_|\___|_|    |_|   \__,_|_| |_|\___|\__|_|\___/|_| |_|
//            |___/
//
//   é«˜éšå‡½å¼ ğŸ“• 8.1


// é¦–å…ˆ lambda æ˜¯å¯ä»¥è¢«å„²å­˜ã€å‚³éçš„

fun verify(x: String, block: (String) -> Boolean): Boolean {
    return block.invoke(x)
}

// TODO: ç°¡åŒ– verify

//
//
//
//
//
fun runVerifyWithLambda() {
    
    val allLowerCase = { s: String -> s.toLowerCase() == s }
    val allUpperCase = { s: String -> s.toUpperCase() == s }
    
    // lambda å¯ä»¥è¢«ç•¶æˆåƒæ•¸å¡é€²å…¶ä»– function å…§
    verify("abcde", allLowerCase)
    verify("ABCDE", allUpperCase)
}


//
//
//
// å› ç‚º lambda æœ¬è³ªå°±æ˜¯ function ï¼Œ æ‰€ä»¥æˆ‘å€‘ç”¨ function åšä¸€æ¬¡
//
//
//
//
fun runVerifyWithFun() {
    
    // TODO: æ”¹æˆ function ç‰ˆ
    
    val allLowerCase = { s: String -> s.toLowerCase() == s }
    val allUpperCase = { s: String -> s.toUpperCase() == s }
    
    verify("abcde", allLowerCase)
    verify("ABCDE", allUpperCase)
}


//
//
// æ¥ä¸‹ä¾†ä¸€æ­¥ä¸€æ­¥çš„ç°¡åŒ– kotlin ä¸­çš„ function
//
//


fun simplifyLambdas() {
    
    
    // åŸºæœ¬çš„ function å®£å‘Š
    fun allLowerCaseFun(s: String): Boolean {
        return s.toLowerCase() == s
    }
    
    //
    // ç°¡åŒ– return
    //
    fun allLowerCaseFun2(s: String): Boolean = (s.toLowerCase() == s)
    
    
    //
    // è‡ªå‹•åµæ¸¬å›å‚³ type
    //
    fun allLowerCaseFun3(s: String) = s.toLowerCase() == s
    
    //
    // è½‰ lambda
    //
    val allLowerCaseFun4 = { s: String -> s.toLowerCase() == s }
    
    
    //
    // ç”¨åœ¨ higher order function ä¸­
    //
    verify("abcde", allLowerCaseFun4)
    
    
    //
    // åŒ¿å lambda
    //
    verify("abcde", { s: String -> s.toLowerCase() == s })
    
    
    //
    // è‡ªå‹•åˆ¤åˆ¥ type
    //
    verify("abcde", { s -> s.toLowerCase() == s })
    
    
    //
    // å–åå«åš it
    //
    verify("abcde", { it -> it.toLowerCase() == it })
    
    
    //
    // it æ˜¯ä¸€å€‹ç‰¹æ®Šçš„è®Šæ•¸åç¨±ï¼Œåœ¨ lambda ä¸­ä»£è¡¨è‘—é è¨­åƒæ•¸ï¼ˆåªæœ‰ä¸€å€‹åƒæ•¸çš„æ™‚å€™ï¼‰ã€‚å¯ä»¥çœç•¥
    //
    verify("abcde", { it.toLowerCase() == it })
    
    
    //
    // higher order function çš„æœ€å¾Œä¸€å€‹åƒæ•¸æ˜¯ lambda æ™‚ï¼Œå¯ä»¥æ‹‰åˆ°æ‹¬è™Ÿå¤–
    //
    verify("abcde") { it.toLowerCase() == it }
}


//
//
// ============================================================================================================
//
//


//    _                    _         _                   __   ____      _ _           _   _
//   | |    __ _ _ __ ___ | |__   __| | __ _  __      __/ /  / ___|___ | | | ___  ___| |_(_) ___  _ __
//   | |   / _` | '_ ` _ \| '_ \ / _` |/ _` | \ \ /\ / / /  | |   / _ \| | |/ _ \/ __| __| |/ _ \| '_ \
//   | |__| (_| | | | | | | |_) | (_| | (_| |  \ V  V / /   | |__| (_) | | |  __/ (__| |_| | (_) | | | |
//   |_____\__,_|_| |_| |_|_.__/ \__,_|\__,_|   \_/\_/_/     \____\___/|_|_|\___|\___|\__|_|\___/|_| |_|
//
//
//   é›†åˆç›¸é—œ Kotlin å…§å»º API ğŸ“• 5.2


//
// +-- ğŸ’¡ é‡é»æ•´ç† --------------------------------------------------------------------------------
// |
// |    Standard library ä¸­æœ‰å¾ˆå¤šå¥½ç”¨çš„ function åˆ©ç”¨äº† lambda çš„ç‰¹æ€§
// |
// |    - forEach
// |    - map
// |    - filter
// |
// |    - ... and more ğŸ”— https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-collection/index.html
// |
// +----------------------------------------------------------------------------------------------


// forEach
/*

public inline fun <T> Iterable<T>.forEach(action: (T) -> Unit): Unit {
    for (element in this) action(element)
}

*/


val names = listOf("Albert", "Ben", "Charlie", "Daniel", "Edward")

fun readNames() {
    names.forEach {
        println("Hello, $it")
    }
}

// â“ forEach å’Œ for .. in çš„å·®ç•°
//
// ğŸ è©¦è‘—å®Œæˆï¸ LambdaWithCollections#Feature("æ‹›å‹Ÿ")


//
// map
//
// map å¯ä»¥æŠŠä¸€é€£ä¸²çš„è³‡æ–™ä¸€å€‹ä¸€å€‹ç”¨åŒæ¨£çš„é‚è¼¯è½‰æ›æˆåˆ¥çš„æ±è¥¿

/*

public inline fun <T, R> Iterable<T>.map(transform: (T) -> R): List<R> {
    return mapTo(ArrayList<R>(collectionSizeOrDefault(10)), transform)
}

 */

val numbers = (1..5)      // [1, 2, 3, 4, 5]
val numberSquare = numbers.map { it * it } // [1, 4, 9, 16, 25]

//
// filter
//
// filter å¯ä»¥æŠŠä¸€å€‹åˆ—è¡¨ä¸­ç¬¦åˆæŸå€‹é‚è¼¯çš„éæ¿¾å‡ºä¾†

/*

public inline fun <T> Iterable<T>.filter(predicate: (T) -> Boolean): List<T> {
    return filterTo(ArrayList<T>(), predicate)
}

 */

val oddNumbers = numbers.filter { it % 2 != 0 }


//
//    ___  ___  __ _ _   _  ___ _ __   ___ ___  ___
//   / __|/ _ \/ _` | | | |/ _ \ '_ \ / __/ _ \/ __|
//   \__ \  __/ (_| | |_| |  __/ | | | (_|  __/\__ \
//   |___/\___|\__, |\__,_|\___|_| |_|\___\___||___/
//                |_|
//
//   åºåˆ—ã€æƒ°æ€§é›†åˆæ“ä½œ ğŸ“• 5.3

//
//
//
//
// ä¸Šé¢çš„é‚£äº› function ä¸€æ¬¡éƒ½æœƒè™•ç†ä¸€æ•´å€‹ list
// ç•¶ list å…§å®¹å¤ªå¤šçš„æ™‚å€™ï¼Œå°è¨˜æ†¶é«”æ˜¯ä¸€å€‹å¾ˆå¤§çš„è² æ“”
//
//
//

//
//
//
//
// ç°¡å–®ç¯„ä¾‹
// ğŸš€ï¸ SequenceTest
//


//
//
//
//
//
// +-- ğŸ’¡ é‡é»æ•´ç† --------------------------------------------------------------------------------
// |
// |    - sequence å¯ä»¥å–®å€‹ item è™•ç†ï¼Œä¸æœƒéœ€è¦è®“è¨˜æ†¶é«”ä¸€æ¬¡å­˜æ”¾å¤§é‡è³‡æ–™
// |    - sequence æ²’æœ‰ terminal operation ä¸æœƒæœ‰çµæœ
// |
// +----------------------------------------------------------------------------------------------


//
//
//
// terminal operator
//
// ğŸ“• 5.3.1
//
// - all & any
// - count


// all æª¢æŸ¥æ˜¯å¦å…¨éƒ¨çš„ item éƒ½ç¬¦åˆ
// any æª¢æŸ¥å…¶ä¸­æ˜¯å¦æœ‰ item éƒ½ç¬¦åˆ

val thisValIsFalse = (1..5).all { it > 3 }
val thisValIsTrue = (1..5).any { it > 3 }


// count è¨ˆç®—åˆ—è¡¨çš„ item æ•¸é‡
val thisValIs6 = (1..20).filter { it < 7 }.count()
val thisValIsAlso6 = (1..20).count { it < 7 }
val thisValIsAlso6Too = (1..20).filter { it < 7 }.size

// â›„ å†·çŸ¥è­˜æ™‚é–“
//
// count åœ¨è¨˜æ†¶é«”ä¸­ï¼Œåªæœƒè¨ˆç®—æ•¸é‡ï¼ˆ item å…§å®¹æœƒè¢« gc æ‰ï¼‰
// size æœƒç”¢ç”Ÿä¸¦å„²å­˜ list å…§å®¹
//
// --> ç•¶åªéœ€è¦æ•¸é‡çš„æ™‚å€™ï¼Œä½¿ç”¨ count æ˜¯æ¯”è¼ƒå„ªåŒ–çš„ä½œæ³•

// ğŸš€ï¸ BasicCounterTest#`lambda can access outer variable`


//
//
// ============================================================================================================
//
//


//   ğŸ”‘ kotlin_lambda_in_java
//
//
//    _  __     _   _ _         _                    _         _
//   | |/ /___ | |_| (_)_ __   | |    __ _ _ __ ___ | |__   __| | __ _
//   | ' // _ \| __| | | '_ \  | |   / _` | '_ ` _ \| '_ \ / _` |/ _` |
//   | . \ (_) | |_| | | | | | | |__| (_| | | | | | | |_) | (_| | (_| |
//   |_|\_\___/ \__|_|_|_| |_| |_____\__,_|_| |_| |_|_.__/ \__,_|\__,_|
//   (_)_ __       | | __ ___   ____ _
//   | | '_ \   _  | |/ _` \ \ / / _` |
//   | | | | | | |_| | (_| |\ V / (_| |
//   |_|_| |_|  \___/ \__,_| \_/ \__,_|
//
//
//   åœ¨ Java ä¸­å¼•ç”¨ Kotlin Lambda ğŸ“• 5.4

// ğŸ“„ å‰å¾€ KtLambda.kt (è¶…ç´šè¿·å®®)
//
// æˆ–æ˜¯ ğŸ”— https://developer.android.com/kotlin/interop#lambda_arguments


//
//
//
//
//


//
//
// ========================= æˆ‘ æ˜¯ åˆ† éš” ç·š =======================================================================
//
//


//
//
//
//
//


//   ğŸ”‘ lambda_with_receiver
//
//
//    _                    _         _                   __
//   | |    __ _ _ __ ___ | |__   __| | __ _  __      __/ /
//   | |   / _` | '_ ` _ \| '_ \ / _` |/ _` | \ \ /\ / / /
//   | |__| (_| | | | | | | |_) | (_| | (_| |  \ V  V / /
//   |_____\__,_|_| |_| |_|_.__/ \__,_|\__,_|   \_/\_/_/
//   |  _ \ ___  ___ ___(_)_   _____ _ __
//   | |_) / _ \/ __/ _ \ \ \ / / _ \ '__|
//   |  _ <  __/ (_|  __/ |\ V /  __/ |
//   |_| \_\___|\___\___|_| \_/ \___|_|
//
//
//   æœ‰æ¥æ”¶å™¨çš„ lambda ğŸ“• 5.5


// ğŸ“„ Monkey.kt (è¶…ç´šè¿·å®® 2)


//
//
//
//
//
//


//
//
// ============================================================================================================
//
//


//   ğŸ”‘ with_friends
//
//
//
//
//
//    _         _   _ _         â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—     __      _                _
//   | | _____ | |_| (_)_ __    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    / _|_ __(_) ___ _ __   __| |___
//   | |/ / _ \| __| | | '_ \   â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   | |_| '__| |/ _ \ '_ \ / _` / __|
//   |   < (_) | |_| | | | | |  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   |  _| |  | |  __/ | | | (_| \__ \
//   |_|\_\___/ \__|_|_|_| |_|  â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   |_| |_|  |_|\___|_| |_|\__,_|___/
//
//
//   with èˆ‡ä»–çš„å€‘çš„ç”¢åœ° ğŸ“• 5.5





