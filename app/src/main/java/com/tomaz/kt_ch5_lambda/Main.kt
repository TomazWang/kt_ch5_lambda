@file:Suppress("unused", "ConvertCallChainIntoSequence", "MoveLambdaOutsideParentheses", "RedundantLambdaArrow")

package com.tomaz.kt_ch5_lambda

import com.tomaz.kt_ch5_lambda.intro.model.Planet

/**
 * Created by TomazWang on 2019/03/22.
 *
 *
 * @author Tomaz Wang
 * @since 2019/03/22
 **/


//  â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—         â–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
//  â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•         â•šâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
//  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
//  â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘       â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
//  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘            â–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
//  â•šâ•â•  â•šâ•â•   â•šâ•â•            â•šâ•â•      â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•


// Great resources
//
// - KotlinConf 2018 - Dissecting the stdlib by Huyen Tue Dao
// ---- ğŸ”— https://youtu.be/Fzt_9I733Yg
// ---- ğŸ”— https://github.com/queencodemonkey/dissecting-the-stdlib
//
// - KotlinConf 2017 - Two Stones, One Bird: Implementation Tradeoffs by Christina Lee
// ---- ğŸ”— https://youtu.be/YxOTU9F_YX4
//
// - Higher-Order Functions and Lambdas
// ---- ğŸ”— https://kotlinlang.org/docs/reference/lambdas.html

//
//
// ============================================================================================================
//
//


//
// ğŸ’¡ ä»Šæ—¥ç›®æ¨™
//
// - å­¸æœƒä»€éº¼æ˜¯ Lambda
// - æ›´äº†è§£ function ( extension function, higher order function, lambda with receiver)
// - å­¸æœƒå…§å»ºçš„å¥½ç”¨ function
//


//
// ğŸ’¡ ä½¿ç”¨æ•™å­¸
//
// - çœ‹åˆ° ğŸ“„ -> æœå°‹ä¸¦åˆ‡æ›åˆ°è©²æª”æ¡ˆ
// - çœ‹åˆ° ğŸš€ -> å‰å¾€è©²æª”æ¡ˆï¼Œä¸¦åŸ·è¡Œ main function
// - çœ‹åˆ° ğŸ -> åˆ‡æ›ä¸¦è©¦è‘—å®Œæˆé€™å€‹æ¸¬è©¦


/**
 * æ‰¾åˆ°é©åˆäººé¡å±…ä½çš„æ˜Ÿçƒ
 *
 * å‡è¨­æˆ‘å€‘ä»Šå¤©è¦ç§»æ°‘å®‡å®™ã€æœ‰ä¸€å€‹ function å¯ä»¥å¿«é€Ÿæ‰¾åˆ°é©åˆçš„æ˜Ÿçƒ
 */
fun findEarthReplacements(planets: List<Planet?>): List<Pair<String, Planet>> =
    planets
        .filterNotNull()
        .filter { it.oxygen > 0.18 }
        .filter { it.water > 0.7 }
        .filter { it.temp < 80 && it.temp > -20 }
        .sortedByDescending { it.size }
        .map { it.name to it }

// è©¦è©¦çœ‹
//
// ğŸš€ IntroTest#`test findEarthReplacements`


//
//
// ============================================================================================================
//
//

//
//   _______                       __                  __    __
//  |       \                     |  \                |  \  |  \
//  | $$$$$$$\  ______    _______  \$$  _______       | $$  | $$  _______   ______    ______    ______
//  | $$__/ $$ |      \  /       \|  \ /       \      | $$  | $$ /       \ |      \  /      \  /      \
//  | $$    $$  \$$$$$$\|  $$$$$$$| $$|  $$$$$$$      | $$  | $$|  $$$$$$$  \$$$$$$\|  $$$$$$\|  $$$$$$\
//  | $$$$$$$\ /      $$ \$$    \ | $$| $$            | $$  | $$ \$$    \  /      $$| $$  | $$| $$    $$
//  | $$__/ $$|  $$$$$$$ _\$$$$$$\| $$| $$_____       | $$__/ $$ _\$$$$$$\|  $$$$$$$| $$__| $$| $$$$$$$$
//  | $$    $$ \$$    $$|       $$| $$ \$$     \       \$$    $$|       $$ \$$    $$ \$$    $$ \$$     \
//   \$$$$$$$   \$$$$$$$ \$$$$$$$  \$$  \$$$$$$$        \$$$$$$  \$$$$$$$   \$$$$$$$ _\$$$$$$$  \$$$$$$$
//                                                                                  |  \__| $$
//                                                                                   \$$    $$
//                                                                                    \$$$$$$

// ğŸ“• 5.1.3


// åŸºæœ¬çš„ function å®£å‘Šæ³•
fun simpleFunction(arg: String) {
    print("Hello $arg")
}


// æœƒå›å‚³è³‡æ–™çš„ function
fun funcWithReturnValue(x: Int): Int {
    val y = x + 1
    return y
}

// ç°¡åŒ–ç°¡å–® return
fun funcWithReturnValue2(x: Int) = x + 1


// ç°¡åŒ–æˆ lambda
val addOne = { x: Int -> x + 1 }


val sumOfEven = { ints: IntArray? ->
    
    if (ints == null) {
        0   // lambda ä¸­ä¸èƒ½ä½¿ç”¨ return, å› ç‚º Kotlin ä¸­ return æ˜¯ return æœ€è¿‘ä¸€å€‹ "fun" å®šç¾©
    } else {
        var sum = 0
        for (i in ints) {
            if (i % 2 == 0) {
                sum += i
            }
        }
        sum
    }
}

//â“é‚£å¦‚æœçœŸçš„å¾ˆæƒ³åŠ  return æ€éº¼è¾¦ => ğŸ BasicCounterTest#`return from lambda`


// â›„ å†·çŸ¥è­˜æ™‚é–“
//
// IntArray è½‰æˆ java æœƒè®Šæˆ int[]
// Array<Int> è½‰æˆ java æœƒè®Šæˆ Integer[]


// lambda å¯ä»¥åƒåˆ°å¤–éƒ¨çš„è®Šæ•¸
var counter = 0
val inc = { counter++ }

// ğŸš€ï¸ BasicCounterTest#`lambda can access outer variable`


//
//
// ============================================================================================================
//
//


//
//   __    __  __            __                                   ______                   __
//  |  \  |  \|  \          |  \                                 /      \                 |  \
//  | $$  | $$ \$$  ______  | $$____    ______    ______        |  $$$$$$\  ______    ____| $$  ______    ______
//  | $$__| $$|  \ /      \ | $$    \  /      \  /      \       | $$  | $$ /      \  /      $$ /      \  /      \
//  | $$    $$| $$|  $$$$$$\| $$$$$$$\|  $$$$$$\|  $$$$$$\      | $$  | $$|  $$$$$$\|  $$$$$$$|  $$$$$$\|  $$$$$$\
//  | $$$$$$$$| $$| $$  | $$| $$  | $$| $$    $$| $$   \$$      | $$  | $$| $$   \$$| $$  | $$| $$    $$| $$   \$$
//  | $$  | $$| $$| $$__| $$| $$  | $$| $$$$$$$$| $$            | $$__/ $$| $$      | $$__| $$| $$$$$$$$| $$
//  | $$  | $$| $$ \$$    $$| $$  | $$ \$$     \| $$             \$$    $$| $$       \$$    $$ \$$     \| $$
//   \$$   \$$ \$$ _\$$$$$$$ \$$   \$$  \$$$$$$$ \$$              \$$$$$$  \$$        \$$$$$$$  \$$$$$$$ \$$
//                |  \__| $$
//                 \$$    $$
//                  \$$$$$$
//                        ________                                 __      __
//                       |        \                               |  \    |  \
//                       | $$$$$$$$__    __  _______    _______  _| $$_    \$$  ______   _______
//                       | $$__   |  \  |  \|       \  /       \|   $$ \  |  \ /      \ |       \
//                       | $$  \  | $$  | $$| $$$$$$$\|  $$$$$$$ \$$$$$$  | $$|  $$$$$$\| $$$$$$$\
//                       | $$$$$  | $$  | $$| $$  | $$| $$        | $$ __ | $$| $$  | $$| $$  | $$
//                       | $$     | $$__/ $$| $$  | $$| $$_____   | $$|  \| $$| $$__/ $$| $$  | $$
//                       | $$      \$$    $$| $$  | $$ \$$     \   \$$  $$| $$ \$$    $$| $$  | $$
//                        \$$       \$$$$$$  \$$   \$$  \$$$$$$$    \$$$$  \$$  \$$$$$$  \$$   \$$
//
//


// é¦–å…ˆ lambda æ˜¯å¯ä»¥è¢«å„²å­˜ã€å‚³éçš„

fun verify(x: String, verifyMethod: (String) -> Boolean) = verifyMethod.invoke(x)

// TODO: ç°¡åŒ– verify

fun runVerifyWithLambda() {
    
    val allLowerCase = { s: String -> s.toLowerCase() == s }
    val allUpperCase = { s: String -> s.toUpperCase() == s }
    
    // lambda å¯ä»¥è¢«ç•¶æˆåƒæ•¸å¡é€²å…¶ä»– function å…§
    verify("abcde", allLowerCase)
    verify("ABCDE", allUpperCase)
}


// å› ç‚º lambda æœ¬è³ªå°±æ˜¯ function ï¼Œ æ‰€ä»¥æˆ‘å€‘ç”¨ function åšä¸€æ¬¡

fun runVerifyWithFun() {
    
    // TODO: æ”¹æˆ function ç‰ˆ
    
    val allLowerCase = { s: String -> s.toLowerCase() == s }
    val allUpperCase = { s: String -> s.toUpperCase() == s }
    
    verify("abcde", allLowerCase)
    verify("ABCDE", allUpperCase)
}


//
//
// æ¥ä¸‹ä¾†ä¸€æ­¥ä¸€æ­¥çš„ç°¡åŒ– kotlin ä¸­çš„ function
//
//


fun simplifyLambdas() {
    
    
    // åŸºæœ¬çš„ function å®£å‘Š
    fun allLowerCaseFun(s: String): Boolean {
        return s.toLowerCase() == s
    }
    
    // ç°¡åŒ– return
    fun allLowerCaseFun2(s: String): Boolean = (s.toLowerCase() == s)
    
    
    // è‡ªå‹•åµæ¸¬å›å‚³ type
    fun allLowerCaseFun3(s: String) = s.toLowerCase() == s
    
    // è½‰ lambda
    val allLowerCaseFun4 = { s: String -> s.toLowerCase() == s }
    
    
    // ç”¨åœ¨ higher order function ä¸­
    verify("abcde", allLowerCaseFun4)
    
    
    // åŒ¿å lambda
    verify("abcde", { s: String -> s.toLowerCase() == s })
    
    
    // è‡ªå‹•åˆ¤åˆ¥ type
    verify("abcde", { s -> s.toLowerCase() == s })
    
    
    // å–åå«åš it
    verify("abcde", { it -> it.toLowerCase() == it })
    
    
    // it æ˜¯ä¸€å€‹ç‰¹æ®Šçš„è®Šæ•¸åç¨±ï¼Œåœ¨ lambda ä¸­ä»£è¡¨è‘—é è¨­åƒæ•¸ï¼ˆåªæœ‰ä¸€å€‹åƒæ•¸çš„æ™‚å€™ï¼‰ã€‚å¯ä»¥çœç•¥
    verify("abcde", { it.toLowerCase() == it })
    
    
    // higher order function çš„æœ€å¾Œä¸€å€‹åƒæ•¸æ˜¯ lambda æ™‚ï¼Œå¯ä»¥æ‹‰åˆ°æ‹¬è™Ÿå¤–
    verify("abcde") { it.toLowerCase() == it }
}



//
//
// ============================================================================================================
//
//



//   __                               __              __                                      __
//  |  \                             |  \            |  \                                    /  \
//  | $$       ______   ______ ____  | $$____    ____| $$  ______         __   __   __      /  $$
//  | $$      |      \ |      \    \ | $$    \  /      $$ |      \       |  \ |  \ |  \    /  $$
//  | $$       \$$$$$$\| $$$$$$\$$$$\| $$$$$$$\|  $$$$$$$  \$$$$$$\      | $$ | $$ | $$   /  $$
//  | $$      /      $$| $$ | $$ | $$| $$  | $$| $$  | $$ /      $$      | $$ | $$ | $$  /  $$
//  | $$_____|  $$$$$$$| $$ | $$ | $$| $$__/ $$| $$__| $$|  $$$$$$$      | $$_/ $$_/ $$ /  $$
//  | $$     \\$$    $$| $$ | $$ | $$| $$    $$ \$$    $$ \$$    $$       \$$   $$   $$|  $$
//   \$$$$$$$$ \$$$$$$$ \$$  \$$  \$$ \$$$$$$$   \$$$$$$$  \$$$$$$$        \$$$$$\$$$$  \$$
//
//
//
//                                       _______                                 __
//                                      |       \                               |  \
//                                      | $$$$$$$\  ______    _______   ______   \$$ __     __   ______    ______
//                                      | $$__| $$ /      \  /       \ /      \ |  \|  \   /  \ /      \  /      \
//                                      | $$    $$|  $$$$$$\|  $$$$$$$|  $$$$$$\| $$ \$$\ /  $$|  $$$$$$\|  $$$$$$\
//                                      | $$$$$$$\| $$    $$| $$      | $$    $$| $$  \$$\  $$ | $$    $$| $$   \$$
//                                      | $$  | $$| $$$$$$$$| $$_____ | $$$$$$$$| $$   \$$ $$  | $$$$$$$$| $$
//                                      | $$  | $$ \$$     \ \$$     \ \$$     \| $$    \$$$    \$$     \| $$
//                                       \$$   \$$  \$$$$$$$  \$$$$$$$  \$$$$$$$ \$$     \$      \$$$$$$$ \$$



